# Database

## Структура

```
db/
├── migrations/     # Миграции схемы БД (CREATE TABLE, ALTER TABLE, etc.)
└── seeds/          # Начальные данные для таблиц (INSERT)
```

## Миграции (migrations/)

Миграции изменяют **структуру** базы данных:
- Создание/изменение таблиц
- Добавление/удаление полей
- Создание индексов
- Триггеры и функции

**Нумерация:** `XXX_description.sql` (например, `002_create_users_table.sql`)

**Запуск:**
```bash
make migrate
```

**Отслеживание:** Применённые миграции сохраняются в таблице `migrations`

## Seeds (seeds/)

Seeds добавляют **начальные данные** в таблицы:
- Тестовые пользователи
- Конфигурации video-service инстансов
- Справочные данные

**Нумерация:** `XXX_seed_description.sql` (например, `001_seed_data.sql`)

**Запуск:**
```bash
make seed
```

**Отслеживание:** Применённые seeds сохраняются в таблице `seeds`

## Команды

```bash
# Применить только миграции
make migrate

# Применить только seeds
make seed

# Инициализация БД (миграции + seeds)
make db-init

# Полный сброс БД (drop/create + миграции + seeds)
make db-reset
```

## Порядок выполнения

1. **Сначала миграции** - создаём структуру БД
2. **Потом seeds** - заполняем данными

```bash
# Первый запуск
make db-init

# Или по отдельности
make migrate
make seed
```

## Как это работает

- `cmd/migrate/main.go` - программа для применения миграций
- `cmd/seed/main.go` - программа для применения seeds
- Обе отслеживают применённые файлы в своих таблицах
- Повторное выполнение безопасно - уже применённые файлы пропускаются
